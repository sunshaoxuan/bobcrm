@using BobCrm.App.Models.Widgets
@using BobCrm.App.Services
@inject I18nService I18n

@* Section 容器的设计态渲染器 *@
<div style="border:@(Section.ContainerLayout.BorderWidth)px @(Section.ContainerLayout.BorderStyle) @(Section.ContainerLayout.BorderColor); border-radius:@(Section.ContainerLayout.BorderRadius)px; background:@(Section.ContainerLayout.BackgroundColor); min-height:@(Section.GetDesignMinHeight())px; display:flex; flex-direction:column; pointer-events:auto;">
    @if (Section.ShowTitle)
    {
        <div style="padding:8px 12px; border-bottom:1px solid #d9d9d9; font-weight:600; font-size:13px; display:flex; justify-content:space-between; align-items:center; flex-shrink:0;">
            <span>@(string.IsNullOrWhiteSpace(Section.Title) ? I18n.T("TXT_GROUP_TITLE_DEFAULT") : Section.Title)</span>
            @if (Section.Collapsible)
            {
                <span style="font-size:10px; color:#999">@I18n.T("TXT_COLLAPSIBLE")</span>
            }
        </div>
    }
    @* 拖放区域：空状态时无padding让placeholder填满，有子组件时有padding分隔 *@
    <div class="frame-drop-zone" data-container-id="@Section.Id"
         style="flex:1; padding:@(Section.Children?.Any() == true ? Section.ContainerLayout.Padding : 0)px; display:flex; flex-direction:@(Section.ContainerLayout.FlexDirection); flex-wrap:@(Section.ContainerLayout.FlexWrap ? "wrap" : "nowrap"); gap:@(Section.ContainerLayout.Gap)px; pointer-events:auto;"
         @ondrop="@OnDrop" @ondrop:preventDefault @ondrop:stopPropagation
         @ondragover="@OnDragOver" @ondragover:preventDefault>
        @if (Section.Children?.Any() == true)
        {
            @foreach (var child in Section.Children)
            {
                @RenderChild(child)
            }
        }
        else
        {
            <div style="flex:1; display:flex; align-items:center; justify-content:center; color:#999; font-size:12px; pointer-events:none">
                @I18n.T("TXT_DRAG_TO_GROUP")
            </div>
        }
    </div>
</div>

@code {
    [Parameter, EditorRequired]
    public SectionWidget Section { get; set; } = null!;

    [Parameter, EditorRequired]
    public RenderFragment<DraggableWidget> RenderChild { get; set; } = null!;

    [Parameter, EditorRequired]
    public EventCallback<Microsoft.AspNetCore.Components.Web.DragEventArgs> OnDrop { get; set; }

    [Parameter, EditorRequired]
    public EventCallback<Microsoft.AspNetCore.Components.Web.DragEventArgs> OnDragOver { get; set; }
}


