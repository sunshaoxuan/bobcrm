@page "/"
@rendermode RenderMode.InteractiveServer
@layout BobCrm.App.Components.Layout.MainLayout

@inject BobCrm.App.Services.I18nService I18n

<AuthChecker>
    <div class="dashboard-shell">
        <section class="dashboard-hero-card">
            <div>
                <p class="dashboard-hero-eyebrow">@I18n.T("TXT_DASH_EYEBROW")</p>
                <h1>@I18n.T("TXT_DASH_TITLE")</h1>
                <p>@I18n.T("TXT_DASH_SUBTITLE")</p>
                <div class="dashboard-hero-metrics">
                    @foreach (var metric in HeroMetrics)
                    {
                        <div class="dashboard-hero-metric">
                            <span>@I18n.T(metric.LabelKey)</span>
                            <strong>@metric.Value</strong>
                            <small>@I18n.T(metric.TrendKey)</small>
                        </div>
                    }
                </div>
            </div>
            <div class="glow"></div>
        </section>

        <div class="dashboard-grid">
            <section class="dashboard-card">
                <div class="dashboard-metrics-grid">
                    @foreach (var metric in MiniMetrics)
                    {
                        <div class="mini-metric">
                            <span>@I18n.T(metric.LabelKey)</span>
                            <strong>@metric.Value</strong>
                            <small>@I18n.T(metric.HintKey)</small>
                        </div>
                    }
                </div>
                <div class="dashboard-segments" style="margin-top:var(--spacing-4)">
                    <h3>@I18n.T("LBL_DASH_SEGMENTS")</h3>
                    @foreach (var segment in Segments)
                    {
                        <div class="segment-row">
                            <div>
                                <strong>@I18n.T(segment.NameKey)</strong>
                                <p class="text-muted">@I18n.T(segment.DescriptionKey)</p>
                            </div>
                            <span>@segment.Count</span>
                        </div>
                    }
                </div>
            </section>

            <aside class="dashboard-card dashboard-right-panel">
                <div>
                    <h3>@I18n.T("LBL_DASH_ACTIVITY")</h3>
                    <p class="text-muted">@I18n.T("TXT_DASH_ACTIVITY_HINT")</p>
                    <div class="dashboard-activity">
                        @foreach (var item in Activity)
                        {
                            <div class="activity-row">
                                <div>
                                    <strong>@item.Title</strong>
                                    <p class="text-muted">@I18n.T(item.DescriptionKey)</p>
                                </div>
                                <span>@(item.TimeIsKey ? I18n.T(item.TimeOrKey) : item.TimeOrKey)</span>
                            </div>
                        }
                    </div>
                </div>
                <div>
                    <h3>@I18n.T("LBL_DASH_NEXT_STEPS")</h3>
                    <div class="dashboard-actions">
                        @foreach (var action in NextActions)
                        {
                            <Button Type="@ButtonType.Default" Ghost Icon="@action.Icon">@I18n.T(action.LabelKey)</Button>
                        }
                    </div>
                </div>
            </aside>
        </div>
    </div>
</AuthChecker>

@code {
    private readonly DashboardMetric[] HeroMetrics =
    [
        new("LBL_METRIC_PIPELINE", "\u00A5 2.8M", "TXT_METRIC_PIPELINE_TREND"),
        new("LBL_METRIC_ACTIVE", "126", "TXT_METRIC_ACTIVE_TREND"),
        new("LBL_METRIC_DAYS", "23d", "TXT_METRIC_DAYS_TREND"),
        new("LBL_METRIC_FEEDBACK", "14", "TXT_METRIC_FEEDBACK_TREND")
    ];

    private readonly DashboardMiniMetric[] MiniMetrics =
    [
        new("LBL_DASH_CUSTOMERS", "248", "TXT_DASH_CUSTOMERS_HINT"),
        new("LBL_DASH_PROJECTS", "42", "TXT_DASH_PROJECTS_HINT"),
        new("LBL_DASH_TOUCHES", "89", "TXT_DASH_TOUCHES_HINT"),
        new("LBL_DASH_SAT", "92%", "TXT_DASH_SAT_HINT")
    ];

    private readonly DashboardSegment[] Segments =
    [
        new("LBL_SEG_ENTERPRISE", "TXT_SEG_ENTERPRISE_DESC", "68"),
        new("LBL_SEG_GROWTH", "TXT_SEG_GROWTH_DESC", "108"),
        new("LBL_SEG_TRIAL", "TXT_SEG_TRIAL_DESC", "72")
    ];

    private readonly DashboardActivity[] Activity =
    [
        new("Nova Retail", "TXT_ACTIVITY_NOVA_DESC", "10:24"),
        new("Helios Labs", "TXT_ACTIVITY_HELIOS_DESC", "09:10"),
        new("ACME Holdings", "TXT_ACTIVITY_ACME_DESC", "TXT_TIME_YESTERDAY", true)
    ];

    private readonly DashboardAction[] NextActions =
    [
        new(IconType.Outline.Plus, "BTN_RECORD_NEXT_TOUCH"),
        new(IconType.Outline.Bell, "BTN_NOTIFY_ACCOUNT"),
        new(IconType.Outline.CloudUpload, "BTN_IMPORT_CONTACTS")
    ];

    private record DashboardMetric(string LabelKey, string Value, string TrendKey);
    private record DashboardMiniMetric(string LabelKey, string Value, string HintKey);
    private record DashboardSegment(string NameKey, string DescriptionKey, string Count);
    private record DashboardActivity(string Title, string DescriptionKey, string TimeOrKey, bool TimeIsKey = false);
    private record DashboardAction(string Icon, string LabelKey);
}
