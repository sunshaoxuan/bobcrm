@page "/"
@rendermode RenderMode.InteractiveServer
@layout BobCrm.App.Components.Layout.AuthLayout

@inject BobCrm.App.Services.AuthService Auth
@inject NavigationManager Nav
@inject BobCrm.App.Services.I18nService I18n

<div class="auth-form auth-redirect">
    <p>@I18n.T("TXT_REDIRECTING")</p>
    <small>@I18n.T("TXT_REDIRECTING_HINT")</small>
</div>

@code {
    protected override async Task OnAfterRenderAsync(bool firstRender)
    {
        if (!firstRender) return;
        try
        {
            var signedIn = await Auth.EnsureAuthenticatedAsync();
            var target = signedIn ? "/customers" : "/login";
            Nav.NavigateTo(target, forceLoad: true);
        }
        catch
        {
            Nav.NavigateTo("/login", forceLoad: true);
        }
    }
}
