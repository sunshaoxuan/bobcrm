# UI / UE 阶段 1 实施计划（Design Tokens & Theme Framework）

> 目标：完成 README 阶段 1 的全部任务，让 Calm 主题具备统一 Token、Theme Provider 以及 Ant Design 覆写的基础设施，为后续组件与模块重构提供落地点。所有命名/数值均以 `docs/UI/UE设计说明书.md` 为唯一来源。

---

## 1. CSS Design Tokens

| 项目 | 任务 | 交付物 | 验收方式 |
| --- | --- | --- | --- |
| Token 文件 | 创建 `wwwroot/css/design-tokens.css`，导出 `:root` 下的静态常量；包括 `color`, `radius`, `shadow`, `blur`, `spacing`, `typography`, `focus-ring`, `motion`。 | CSS 文件 + 注释引用说明书章节 | 1) 检查文件引用的数值与说明书 3.1–3.4 完全一致；2) 不含其它色值。 |
| 主题命名空间 | 定义 `:root.theme-calm-light` 与 `:root.theme-calm-dark`，分别覆盖背景/中性色/阴影/语义色映射，遵循说明书 3.5。 | 同一文件中的 `.theme-calm-light/.theme-calm-dark` 块 | 浏览器 DevTools 中切换类并截图，确认颜色/阴影切换符合规范。 |
| 工具类 | 提供基础 utility 类（`glass-surface`, `glass-elevated`, `elev-flat/raised/pressed`, `text-title/body/meta` 等）方便组件复用。 | 附加在 `design-tokens.css` 或 `theme.css` 中的 `.u-*` 类 | Story/demo 页面展示 3 个容器应用不同 elevation + blur 的效果。 |
| 引用顺序 | 在 `App.razor` 中引入 `design-tokens.css` 早于 `theme.css`；更新 README “阶段 1” 验收指引。 | 代码更新 + README 链接 | `document.documentElement` 默认拥有 `theme-calm-light` 类；切换 dark 类后颜色即更新。 |

---

## 2. Theme Provider（Blazor）

| 项目 | 任务 | 交付物 | 验收方式 |
| --- | --- | --- | --- |
| 状态服务 | 创建 `ThemeState`（或类似服务），维护 `CurrentTheme`（`calm-light/calm-dark`）与订阅机制。默认值 `calm-light`，可从服务器/用户偏好扩展。 | `Services/ThemeState.cs` | 单元测试或最小示例：调用 `SetTheme("calm-dark")` 会触发事件，Layout 响应添加类。 |
| Layout 集成 | 在 `MainLayout` / `EmptyLayout` 的根元素上绑定 `theme-calm-light` 类，并根据 `ThemeState` 自动切换。 | 布局文件更新 | Render 后 HTML `<body>` 或顶层 `div` 上出现正确类名；切换 API 以后 UI 实时更新。 |
| JS 互操作 | 提供 `theme.js`（或复用 app.js）中轻量函数 `window.bobcrmTheme.apply(themeName)`，仅负责在 `<html>` 或 `<body>` 上添加/移除 `theme-calm-*`。不再使用 localStorage。 | JS 文件 + `ThemeState` 调用 | `ThemeState` 切换后调用 JS，DevTools 中类名更新，且无闪烁。 |
| 设置入口 | 在 Settings 页面保留“语言”外，新增只读展示“当前主题：Calm Neumorphic Glass”；暂不提供 UI 切换，但预留 `ThemeState.SetTheme` API 供未来使用。 | Settings UI | README 标记“暂不提供 UI 切换，接口已准备”。 |

---

## 3. Ant Design 覆写基座

| 项目 | 任务 | 交付物 | 验收方式 |
| --- | --- | --- | --- |
| 变量映射 | 新建 `wwwroot/css/ant-overrides.css`，通过 `:root` 变量把 Ant Design 的 `--ant-primary-color`、`--ant-success-color` 等映射到 Token。 | CSS 文件 + 引入 | Ant 组件（Button、Input）默认颜色切换为 `primary/600`。 |
| 样式覆盖 | 调整常见组件（按钮、输入、表格、弹窗）以玻璃/soft 风格呈现：背景透明+blur、阴影引用 Token。 | CSS 选择器（如 `.ant-btn`） | 页面中现有 Ant 按钮呈现新风格，且 hover/active/focus 依规范。 |
| 文档 | 在 README 阶段 1 部分添加“AntD覆写完成/验证方式”，并记录对齐 `docs/UI/UE设计说明书.md` 的章节。 | README 更新 | 代码审查/验证 checklist 使用本节。 |

---

## 4. 验证与交付

1. **示例页面**：创建 `Components/Pages/ThemePlayground.razor`（或 Storybook 替代）展示按钮、输入、卡片、玻璃容器在 light/dark 下的效果，作为人工回归基准。  
2. **自动校验**：在 `package.json` 或脚本中加入 Stylelint 规则：禁止非 Token 色值（可后续执行，先写 TODO）。  
3. **README 勾选**：完成每项任务后更新 README 阶段 1 的勾选状态，并附验证截图位置（可先使用 “docs/screenshots/theme-light.png” 等占位）。  
4. **残留清理**：确保代码库中没有 `localStorage theme / udfColor`、`dynamic-theme` style 标签、`setTheme/setPrimary` 等旧逻辑；若发现需追加列入差距报告附录。

---

## 5. 讨论记录（如需）

| 议题 | 当前结论 | 待定事项 |
| --- | --- | --- |
| 夜间模式的首波交付范围 | 仅保证颜色/阴影切换正确；组件细节在阶段 3 贯彻 | 需在阶段 3 期间继续验证 |
| 主题切换触发方式 | 暂不提供 UI；未来可在 Settings or 快捷菜单中接入 `ThemeState` | 需在开始阶段 2/3 前再评估 |
| Token 扩展流程 | 若出现文档未定义的视觉元素，先更新 `docs/UI/UE设计说明书.md` 与本计划，再实施 | —— |

> 完成阶段 1 后，即可进入阶段 2（应用骨架），届时所有布局/组件应直接引用上述 Token 与 Theme Provider，不再写死颜色。
