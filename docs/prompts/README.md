# AI 驱动代码审查 Prompts

**目录位置**: `docs/prompts/`
**创建日期**: 2025-12-25

---

## 目录

本目录包含用于驱动 AI 进行代码审查的 Prompt 和模板。

| 文件 | 类型 | 说明 |
|------|------|------|
| [PROMPT-01-全面代码审查.md](PROMPT-01-全面代码审查.md) | Prompt | 完整的代码审查执行指令 |
| [TEMPLATE-01-代码审查报告模板.md](TEMPLATE-01-代码审查报告模板.md) | 模板 | 审查报告输出格式 |
| [TEMPLATE-02-改进计划模板.md](TEMPLATE-02-改进计划模板.md) | 模板 | 改进计划输出格式 |

---

## 快速开始

### 方式一：完整审查（推荐）

适用于版本发布前或季度审查。

```bash
# 1. 在 Claude Code 中执行
# 复制 PROMPT-01-全面代码审查.md 的内容到对话中

# 2. AI 将自动：
#    - 阅读项目规范文档
#    - 进行功能评审
#    - 进行代码质量评审
#    - 生成审查报告

# 3. 审查完成后，将报告保存到：
#    docs/reviews/REVIEW-XX-全面代码审查-YYYY-MM.md

# 4. 根据报告生成改进计划：
#    docs/plans/PLAN-XX-审查改进计划-YYYY-MM.md
```

### 方式二：分阶段审查

适用于时间有限或需要深入审查特定领域。

**阶段一：文档学习**
```
请阅读以下文档并总结关键要点：
1. CLAUDE.md
2. docs/process/STD-01-开发质量标准.md
3. docs/process/STD-05-多语言开发规范.md
4. docs/design/ARCH-20-实体定义管理设计.md
5. docs/design/ARCH-21-组织与权限体系设计.md
```

**阶段二：功能评审**
```
基于项目规范，对以下模块进行功能评审：
- 实体系统
- 权限系统
- 表单系统
输出问题清单，标注优先级(P0/P1/P2)。
```

**阶段三：代码质量评审**
```
对以下目录进行代码质量评审：
- src/BobCrm.Api/Services/
- src/BobCrm.Api/Endpoints/
检查 SOLID 原则、异常处理、I18n 合规性。
```

**阶段四：生成改进计划**
```
基于前面的评审结果，生成改进计划。
使用 TEMPLATE-02-改进计划模板.md 格式。
```

### 方式三：专项审查

针对特定领域的深入审查。

**I18n 专项审查**
```
请对 BobCRM 项目进行 I18n 合规性专项审查。

参考规范：
- docs/process/STD-05-多语言开发规范.md
- docs/process/PROC-05-I18n扫描规则.md

检查范围：
- src/BobCrm.Api/
- src/BobCrm.App/

输出：
1. 硬编码中文清单（文件:行号:内容）
2. 缺失翻译的资源键清单
3. 资源键命名不规范清单
```

**安全专项审查**
```
请对 BobCRM 项目进行安全专项审查。

检查项：
- SQL 注入风险
- XSS 风险
- CSRF 防护
- 认证授权漏洞
- 敏感数据泄露

重点检查：
- src/BobCrm.Api/Endpoints/
- src/BobCrm.Api/Middleware/
- src/BobCrm.Api/Controllers/

输出安全漏洞清单和修复建议。
```

**性能专项审查**
```
请对 BobCRM 项目进行性能专项审查。

检查项：
- N+1 查询问题
- 缺少索引
- 不必要的 Include
- 内存泄漏风险
- 缓存使用情况

重点检查：
- src/BobCrm.Api/Services/
- src/BobCrm.Api/Infrastructure/Ef/

输出性能问题清单和优化建议。
```

---

## 审查输出物

完成审查后，应产出以下文档：

```
docs/
├── reviews/
│   └── REVIEW-XX-全面代码审查-YYYY-MM.md    # 审查报告
├── plans/
│   └── PLAN-XX-审查改进计划-YYYY-MM.md      # 改进计划
└── history/
    └── AUDIT-XX-代码审查问题清单-YYYY-MM.md # 问题详单（可选）
```

### 命名规则

- `XX`：序号，查看目录中现有最大序号后递增
- `YYYY-MM`：审查年月

### 文件存放

| 文件类型 | 存放目录 | 说明 |
|----------|----------|------|
| 审查报告 | `docs/reviews/` | 每次审查的完整报告 |
| 改进计划 | `docs/plans/` | 基于审查的改进计划 |
| 问题清单 | `docs/history/` | 详细问题清单（归档） |

---

## 评审周期建议

| 审查类型 | 频率 | 触发条件 |
|----------|------|----------|
| 完整审查 | 季度 | 版本发布前 |
| 功能审查 | 月度 | 新功能完成后 |
| 代码审查 | 持续 | PR 合并前 |
| 专项审查 | 按需 | 发现特定问题时 |

---

## 与现有流程集成

### PR 检查清单集成

在 `PROC-01-PR检查清单.md` 中增加：

```markdown
### AI 代码审查
- [ ] 已使用 AI 工具进行代码质量检查
- [ ] 发现的问题已修复或记录
```

### 版本发布流程集成

版本发布前：
1. 执行完整代码审查
2. 确保 P0/P1 问题全部修复
3. 更新 CHANGELOG
4. 归档审查报告

---

## 常见问题

### Q: 审查耗时太长怎么办？

A: 建议分阶段执行，或聚焦特定模块进行专项审查。

### Q: AI 发现的问题不准确怎么办？

A: AI 审查结果需要人工确认。对于不确定的问题，标记为 P3 待确认。

### Q: 如何跟踪改进进度？

A: 使用改进计划模板中的"执行进度追踪"章节，每日更新完成状态。

### Q: 历史审查报告如何管理？

A: 所有审查报告保存在 `docs/reviews/`，按时间和版本组织。

---

## 维护说明

- 本目录的 Prompt 和模板需要随项目规范演进而更新
- 每次更新规范文档后，检查 Prompt 是否需要同步更新
- 新增审查维度时，同步更新模板格式

---

**最后更新**: 2025-12-25
**维护者**: BobCRM 开发团队
