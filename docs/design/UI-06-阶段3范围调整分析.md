# UI-06: 阶段 3 范围调整分析

## 1. 问题发现

在尝试对 Users / Roles / Organizations 模块进行“模板化重构”过程中，发现**模板驱动的列表（`ListTemplateHost` + `DataGridWidget`）**与这些模块的交互形态存在根本不匹配，继续推进会导致投入高、收益低，甚至破坏现有可用性。

## 2. 现状模块分析

### ✅ Customer 模块（已完成改造）
- **形态**：标准业务实体列表 + 常规 CRUD
- **UI**：单列表视图（列、分页、排序等）
- **模板适配度**：高（适配 `ListTemplateHost` + `DataGridWidget`）
- **状态**：✅ 已完成

### ❌ Users 模块（不适合“简单模板”）
- **形态**：典型主从工作台（多面板协同）
- **主要 UI 组成**：
  - 左侧：用户列表 + 搜索
  - 右侧面板 1：用户信息表单（用户名、邮箱、状态等）
  - 右侧面板 2：角色分配（checkbox 列表）
- **交互**：选中用户 → 加载详情 → 编辑信息 / 分配角色
- **模板适配度**：低（这是“管理工作台”，不是“数据表格”）

### ❌ Roles 模块（不适合“简单模板”）
- **形态**：主从工作台 + 树形复杂交互
- **主要 UI 组成**：
  - 左侧：角色列表 + 搜索
  - 右侧面板 1：角色表单（code/name/description 等）
  - 右侧面板 2：权限树（层级 checkbox + 模板选择等）
- **交互**：选中角色 → 加载详情 → 编辑信息 / 配置权限
- **模板适配度**：低（核心是权限树，不是扁平表格）

### ❓ Organizations 模块（倾向不适配）
- **形态假设**：组织树/树表（层级结构）
- **模板适配度**：偏低（扁平 DataGrid 不适配树形数据）

## 3. 关键结论

`ListTemplateHost` + `DataGridWidget` 的设计目标是：
- **简单业务实体列表**（例如 Customer / Product / Order）
- **标准 CRUD 操作**（查看 / 编辑 / 删除）
- **以行列为核心的表格展示**

它并不适合：
- **管理型工作台**（User/Role 等需要多面板联动）
- **主从联动 + 多区域协同**
- **树形/层级数据交互**（权限树、组织树）
- **复杂交互模型**（多选、嵌套选择、跨面板联动）

## 4. 阶段 3 范围调整建议

### 原范围（过宽）
```
- Customer 模块模板化 ✅
- Organization/User/Role 模板化 ❌（方向不匹配）
- Form Designer 改造 ❌（建议后移）
- Record Workspace ✅（仅验证即可）
```

### 调整后范围（可落地）
```
阶段 3：面向“业务实体”的模板化 CRUD
- [x] Customer 模块模板化（已完成）
- [x] 验证基础设施对系统实体可用
- [ ] 验证 Record Workspace（DynamicEntityData.razor）对动态实体模板的使用
- [ ] 更新阶段 3 文档与说明
- [ ] 归档阶段 3 结论

阶段 3 不再覆盖：
- Users/Roles/Organizations：属于“系统管理工具”，不是业务实体 CRUD
- Form Designer：作为 meta-tool，建议单独阶段推进
```

## 5. 为什么保持 Users/Roles 现状

1. **现有实现已可用且结构清晰**：遵循既有 Blazor 组件化与交互模式
2. **模板化无法覆盖关键交互**：`DataGridWidget` 无法承载权限树/多面板协同
3. **面向对象不同**：这是系统管理界面，不是业务实体数据录入
4. **ROI 过低**：重构成本高，收益有限

## 6. 后续建议

1. 接受范围调整：阶段 3 聚焦“业务实体模板化 CRUD”
2. 将 Users/Roles/Organizations 标记为“无需模板化改造”并进入维护模式
3. 验证 Record Workspace 的模板能力（动态实体数据页）
4. 更新相关文档（计划、审计、变更说明等）并归档结论

## 7. 可选扩展（后续阶段）

如果未来希望“模板系统”覆盖 Users/Roles 这类管理工作台，建议新增更高阶 Widget：
- `MasterDetailWidget`：左列表 + 右详情多面板
- `PermissionTreeWidget`：树形权限选择
- `MultiPanelWidget`：面板容器 + 联动协议

该方向属于后续阶段工作，不建议纳入阶段 3。
