# PLAN-20-下一阶段改进计划-2025-12

**创建日期**: 2025-12-27  
**背景**: PLAN-18（代码质量改进）已完成；PLAN-19（文档一致性改进）P1/P2 已完成，P3 为可选项  
**状态**: 进行中

---

## 一、待实施任务

### 1.1 优先级 1：P3 可选优化（来自 PLAN-19）

| 任务 | 文件 | 说明 | 验收标准 |
|------|------|------|----------|
| P3-001 | `src/BobCrm.Api/Services/EntityDefinitionAppService.cs` | 删除 `Interface/System` 字段时抛出明确业务错误（不再静默跳过） | 删除受保护字段时返回 `FIELD_PROTECTED_BY_SOURCE`（对应文案 Key：`ERR_FIELD_PROTECTED_BY_SOURCE`） |
| P3-002 | `docs/reference/API-01-接口文档.md` | 更新过时的响应示例，确保与实现一致 | 示例与实际返回结构一致（含成功包装体、并发冲突错误等） |

### 1.2 优先级 2：技术债务

| 任务 | 预计工时 | 说明 | 验收标准 |
|------|----------|------|----------|
| CS0618 警告消除 | 8h | 清理 10 处过时 API 使用（禁止继续用 `#pragma` 掩盖） | `dotnet build` 无 CS0618 新增；基线脚本通过 |
| 模板绑定迁移 | 16h | `TemplateBinding` → `TemplateStateBinding`（数据结构/服务/测试同步迁移） | 功能无回归，测试通过，且不依赖 Obsolete 字段 |

---

## 二、执行与验证

### 2.1 必跑命令（本计划验收门禁）

- 测试：`dotnet test -c Release`
- 警告基线：`pwsh scripts/check-warning-baseline.ps1`

### 2.2 文档约束

- 文档内容全中文（代码/示例除外）。
- 与多语相关的系统能力必须至少覆盖 `zh/ja/en`，且支持扩展语种（资源键与检查脚本需保持可维护）。

---

## 三、里程碑（建议）

| 里程碑 | 内容 | 截止日期 |
|--------|------|----------|
| M1 | P3-001/P3-002 完成 | 2025-12-30 |
| M2 | CS0618 警告消除 | 2026-01-07 |
| M3 | 模板绑定迁移完成 | 2026-01-17 |

---

## 四、变更记录

| 版本 | 日期 | 变更内容 |
|------|------|----------|
| 1.0 | 2025-12-27 | 初始创建 |

