## å®¢æˆ·ä¿¡æ¯ç®¡ç†ç³»ç»Ÿå¼€å‘ä»»åŠ¡æ¸…å•ï¼ˆå‰åç«¯æ‹†è§£ï¼‰

---

### âœ… ç¬¬ä¸€é˜¶æ®µï¼šé¡¹ç›®åˆå§‹åŒ–ï¼ˆå‰ç«¯ä¼˜å…ˆï¼‰

#### å‰ç«¯ä»»åŠ¡ï¼š
- [ ] åˆ›å»º Blazor WASM æˆ– Blazor Server é¡¹ç›®ï¼Œæ­å»ºåŸºç¡€é¡¹ç›®ç»“æ„
- [ ] é›†æˆ Ant Design Blazor ç»„ä»¶åº“
- [ ] å®ç°å›½é™…åŒ–è¯­è¨€åˆ‡æ¢ç»„ä»¶ï¼ˆä¸­/æ—¥/è‹±ï¼‰
- [ ] ç¼–å†™ç™»å½•é¡µã€ç©ºç™½ä¸»é¡µé¢ï¼ˆæ— æ•°æ®ï¼‰
- [ ] é›†æˆå‰åç«¯ Token è®¤è¯æœºåˆ¶ï¼ˆå‡†å¤‡å‰ç«¯è°ƒç”¨æ¥å£çš„ Token æ³¨å…¥é€»è¾‘ï¼‰

#### åç«¯ä»»åŠ¡ï¼š
- [ ] åˆ›å»º .NET Web API é¡¹ç›®ï¼Œæ­å»ºå¾®æœåŠ¡ç»“æ„ï¼ˆå¯å…ˆå•ä½“ï¼‰
- [ ] å¼•å…¥ EF Core + SQLiteï¼Œé…ç½®æ•°æ®åº“è¿æ¥
- [ ] é…ç½® ASP.NET Identityï¼Œå®ç°åŸºæœ¬æ³¨å†Œã€ç™»å½•ã€ç”¨æˆ·è§’è‰²æ¨¡å‹ï¼ˆç®¡ç†å‘˜ã€æ™®é€šç”¨æˆ·ï¼‰
- [ ] æä¾›ç™»å½•/æ³¨å†Œ APIï¼Œè¿”å› JWT

---

### âœ… ç¬¬äºŒé˜¶æ®µï¼šå®¢æˆ·ä¸»æ•°æ®ç®¡ç†

#### å‰ç«¯ä»»åŠ¡ï¼š
- [ ] å®¢æˆ·åˆ—è¡¨é¡µé¢ï¼ˆå±•ç¤º Codeã€Nameï¼‰
- [ ] å®ç°å®¢æˆ·æœç´¢ï¼ˆå‰ç«¯æˆ–åç«¯è¿‡æ»¤ï¼‰
- [ ] ç‚¹å‡»å®¢æˆ·è¿›å…¥è¯¦æƒ…é¡µï¼ˆåˆå§‹é™æ€å¸ƒå±€ï¼‰

#### åç«¯ä»»åŠ¡ï¼š
- [ ] åˆ›å»º Customer è¡¨ï¼ˆId, Code, Name, Version, ExtDataï¼‰
- [ ] å®ç°è·å–å®¢æˆ·åˆ—è¡¨ã€å®¢æˆ·è¯¦æƒ…ã€å®¢æˆ·æ–°å¢ã€æ›´æ–° API
- [ ] éªŒè¯æƒé™ï¼šç”¨æˆ·åªèƒ½è®¿é—®è‡ªå·±æœ‰æƒé™çš„å®¢æˆ·ï¼ˆå…ˆé»˜è®¤å…¨éƒ¨å¯è§ï¼‰

---

### âœ… ç¬¬ä¸‰é˜¶æ®µï¼šå­—æ®µå®šä¹‰ä¸æ‰©å±•æ¨¡å‹æ”¯æŒ

#### å‰ç«¯ä»»åŠ¡ï¼š
- [ ] åŠ¨æ€æ¸²æŸ“å­—æ®µåŒºåŸŸï¼šæ ¹æ®åç«¯è¿”å›å­—æ®µå®šä¹‰ + å®¢æˆ·å­—æ®µå€¼æ¸²æŸ“æ§ä»¶
- [ ] å®ç°ç®€å•çš„å­—æ®µè¡¨å•ï¼ˆæ–‡æœ¬ã€æ•°å­—ã€æ—¥æœŸï¼‰å±•ç¤ºå’Œç¼–è¾‘

#### åç«¯ä»»åŠ¡ï¼š
- [ ] åˆ›å»º FieldDefinition è¡¨ï¼šå­—æ®µIdã€Keyã€æ˜¾ç¤ºåã€æ ‡ç­¾ã€ç±»å‹ã€å›¾æ ‡ã€åŠ¨ä½œJSONç­‰
- [ ] è¿”å›å­—æ®µå®šä¹‰ API
- [ ] æ›´æ–° Customer æ¥å£æ”¯æŒå­—æ®µæ•°æ®ä¸ ExtData è”åŠ¨
- [ ] ä¸ºå®¢æˆ·è®°å½•åˆ†é… Version

---

### âœ… ç¬¬å››é˜¶æ®µï¼šå‰ç«¯è®¾è®¡æ¨¡å¼ä¸å¸ƒå±€å®šåˆ¶

#### å‰ç«¯ä»»åŠ¡ï¼š
- [ ] æ·»åŠ â€œè®¾è®¡æ¨¡å¼â€å¼€å…³
- [ ] è®¾è®¡æ¨¡å¼ä¸‹æ”¯æŒå­—æ®µå—æ‹–æ‹½æ’åºã€å®½åº¦è°ƒæ•´ã€æ˜¾ç¤º/éšè—
- [ ] æ‹–æ‹½å¸é™„å¯¹é½çº¿è¾…åŠ©
- [ ] ä¿å­˜å¸ƒå±€åˆ°åç«¯ï¼ˆUserLayout è¡¨ï¼‰
- [ ] åŠ è½½ç”¨æˆ·å®šåˆ¶å¸ƒå±€ï¼Œè¿è¡Œæ¨¡å¼ä¸‹å›ºå®šæ˜¾ç¤º

#### åç«¯ä»»åŠ¡ï¼š
- [ ] åˆ›å»º UserLayout è¡¨ï¼Œå­˜å‚¨æ¯ä¸ªç”¨æˆ·çš„å­—æ®µå¸ƒå±€JSON
- [ ] å¸ƒå±€è¯»å–ä¸ä¿å­˜ APIï¼ˆæŒ‰UserId + CustomerIdï¼‰

---

### âœ… ç¬¬äº”é˜¶æ®µï¼šç‰¹æ®Šå­—æ®µç±»å‹æ”¯æŒï¼ˆEmail/RDS/æ–‡ä»¶/é“¾æ¥ï¼‰

#### å‰ç«¯ä»»åŠ¡ï¼š
- [ ] Email å­—æ®µæ·»åŠ å›¾æ ‡+ä¸‹æ‹‰èœå•
- [ ] Link å­—æ®µå¯ç‚¹å‡»æ‰“å¼€æ–°æ ‡ç­¾é¡µ
- [ ] File å­—æ®µå¯ç‚¹å‡»å¤åˆ¶è·¯å¾„/æ‰“å¼€æ–‡ä»¶ï¼ˆfile://ï¼‰
- [ ] RDS å­—æ®µç‚¹å‡»ç”Ÿæˆå¹¶ä¸‹è½½ .rdp æ–‡ä»¶

#### åç«¯ä»»åŠ¡ï¼š
- [ ] å­—æ®µåŠ¨ä½œé…ç½®æ”¯æŒå›¾æ ‡ã€äº‹ä»¶ã€ä¸‹çº§åŠ¨ä½œï¼ˆæ¥å£ IFieldAction å®šä¹‰ï¼‰
- [ ] æä¾› RDP æ–‡ä»¶ç”Ÿæˆ APIï¼ˆå«å¯†ç åŠ å¯†ï¼‰
- [ ] æä¾› File è·¯å¾„éªŒè¯æˆ–é‡å®šå‘å¤„ç†

---

### âœ… ç¬¬å…­é˜¶æ®µï¼šå¤šç”¨æˆ·æƒé™ + å¤šè¯­è¨€

#### å‰ç«¯ä»»åŠ¡ï¼š
- [ ] ç™»å½•åæ ¹æ®æƒé™åŠ è½½å®¢æˆ·åˆ—è¡¨
- [ ] åˆ‡æ¢è¯­è¨€ååˆ·æ–°è¯­è¨€åŒ…ï¼Œé¡µé¢å†…å®¹åŠ¨æ€æ›´æ–°

#### åç«¯ä»»åŠ¡ï¼š
- [ ] åˆ›å»º CustomerAccess è¡¨ï¼ˆCustomerId, UserId, CanEditï¼‰
- [ ] åˆ›å»º LocalizationResource è¡¨ï¼ˆKey, ZH, JA, ENï¼‰
- [ ] å¤šè¯­è¨€æ¥å£ï¼Œæ”¯æŒå‰ç«¯æŒ‰è¯­è¨€åŠ è½½è¯å…¸èµ„æº


---

## ER å›¾ï¼ˆMarkdown è¡¨è¾¾ï¼‰

```mermaid
erDiagram
    User ||--o{ CustomerAccess : has
    Customer ||--o{ CustomerAccess : has
    Customer ||--o{ UserLayout : has
    Customer ||--o{ FieldValue : has
    FieldDefinition ||--o{ FieldValue : defines

    User {
        int Id
        string Username
        string PasswordHash
        string Role
        string PreferredLanguage
    }

    Customer {
        int Id
        string Code
        string Name
        int Version
        json ExtData
    }

    CustomerAccess {
        int Id
        int CustomerId
        int UserId
        bool CanEdit
    }

    FieldDefinition {
        int Id
        string Key
        string DisplayName
        string DataType
        json Tags
        json Actions
    }

    FieldValue {
        int Id
        int CustomerId
        int FieldDefinitionId
        string Value
        int Version
    }

    UserLayout {
        int Id
        int UserId
        int CustomerId
        json LayoutJson
    }
```

---

## API æ¥å£æ–‡æ¡£ï¼ˆMarkdown æ ¼å¼ï¼‰

### ğŸ” ç™»å½• API
- URL: `POST /api/auth/login`
- Body:
```json
{
  "username": "admin",
  "password": "123456"
}
```
- Response:
```json
{
  "accessToken": "{JWT Token}",
  "refreshToken": "{Refresh Token}",
  "user": { "id": "00000000-0000-0000-0000-000000000000", "username": "admin", "role": "user" }
}
```

### ğŸ†• ç”¨æˆ·æ³¨å†Œ
- URL: `POST /api/auth/register`
- Body:
```json
{
  "username": "user1",
  "password": "P@ssw0rd!",
  "email": "user1@example.com"
}
```
- Response:
```json
{ "success": true, "message": "æ³¨å†ŒæˆåŠŸï¼Œè¯·æŸ¥æ”¶é‚®ä»¶æ¿€æ´»è´¦æˆ·" }
```

### âœ‰ï¸ é‚®ä»¶æ¿€æ´»
- URL: `GET /api/auth/activate?userId={id}&code={token}`
- Response:
```json
{ "success": true, "message": "è´¦æˆ·æ¿€æ´»æˆåŠŸ" }
```

### â™»ï¸ åˆ·æ–°ä»¤ç‰Œ
- URL: `POST /api/auth/refresh`
- Body:
```json
{ "refreshToken": "{Refresh Token}" }
```
- Response:
```json
{ "accessToken": "{JWT Token}", "refreshToken": "{New Refresh Token}" }
```

### ğŸšª ç™»å‡º
- URL: `POST /api/auth/logout`
- Body:
```json
{ "refreshToken": "{Refresh Token}" }
```
- Response:
```json
{ "success": true, "message": "ç™»å‡ºæˆåŠŸ" }
```

### ğŸ‘¤ ä¼šè¯éªŒè¯
- URL: `GET /api/auth/session`
- Header: `Authorization: Bearer {token}`
- Response:
```json
{ "valid": true, "user": { "id": "00000000-0000-0000-0000-000000000000", "username": "admin" } }
```

### ğŸ™‹ å½“å‰ç”¨æˆ·ä¿¡æ¯
- URL: `GET /api/auth/me`
- Header: `Authorization: Bearer {token}`
- Response:
```json
{
  "id": "00000000-0000-0000-0000-000000000000",
  "username": "admin",
  "email": "admin@local",
  "emailConfirmed": true,
  "roles": ["admin"]
}
```

---

### ğŸ“‹ è·å–å®¢æˆ·åˆ—è¡¨
- URL: `GET /api/customers`
- Header: `Authorization: Bearer {token}`
- Response:
```json
[
  { "id": 1, "code": "C001", "name": "å®¢æˆ·A" },
  { "id": 2, "code": "C002", "name": "å®¢æˆ·B" }
]
```

---

### â• åˆ›å»ºå®¢æˆ·
- URL: `POST /api/customers`
- Header: `Authorization: Bearer {token}`
- Body:
```json
{ "code": "C100", "name": "å®¢æˆ·Z" }
```
- Response:
```json
{ "id": 10, "code": "C100", "name": "å®¢æˆ·Z" }
```

---

### ğŸ“„ è·å–å®¢æˆ·è¯¦æƒ…ï¼ˆå«å­—æ®µå€¼ï¼‰
- URL: `GET /api/customers/{id}`
- Header: `Authorization: Bearer {token}`
- Response:
```json
{
  "id": 1,
  "code": "C001",
  "name": "å®¢æˆ·A",
  "version": 2,
  "fields": [
    { "key": "email", "label": "é‚®ç®±", "type": "email", "value": "a@b.com" },
    { "key": "rds", "label": "RDSæœåŠ¡å™¨", "type": "rds", "value": { "ip": "10.0.0.1", "user": "admin" } }
  ]
}
```

---

### ğŸ›¡ï¸ ç®¡ç†å®¢æˆ·è®¿é—®æƒé™ï¼ˆç®¡ç†å‘˜ï¼‰
- URL: `GET /api/customers/{id}/access`
- Header: `Authorization: Bearer {token}`
- Response:
```json
[
  { "userId": "00000000-0000-0000-0000-000000000000", "canEdit": true }
]
```

- URL: `POST /api/customers/{id}/access`
- Body:
```json
{ "userId": "00000000-0000-0000-0000-000000000001", "canEdit": false }
```
- Response:
```json
{ "success": true, "message": "æƒé™è®¾ç½®æˆåŠŸ" }
```

---

### ğŸ§© è·å–å­—æ®µå®šä¹‰åˆ—è¡¨
- URL: `GET /api/fields`
- Header: `Authorization: Bearer {token}`
- Response:
```json
[
  {
    "key": "email",
    "label": "é‚®ç®±",
    "type": "email",
    "tags": ["è”ç³»"],
    "actions": [
      { "icon": "mail", "title": "å†™é‚®ä»¶", "type": "click", "action": "mailto" }
    ]
  }
]
```

---

### ğŸ·ï¸ è·å–å­—æ®µæ ‡ç­¾
- URL: `GET /api/fields/tags`
- Header: `Authorization: Bearer {token}`
- Response:
```json
[
  { "tag": "è”ç³»", "count": 3 }
]
```

---

### ğŸ’¾ ä¿å­˜å®¢æˆ·æ•°æ®ï¼ˆå«å­—æ®µï¼‰
- URL: `PUT /api/customers/{id}`
- Header: `Authorization: Bearer {token}`
- Body:
```json
{
  "fields": [
    { "key": "email", "value": "test@test.com" },
    { "key": "rds", "value": { "ip": "10.1.1.1", "user": "admin" } }
  ]
}
```
- Response:
```json
{ "status": "success", "newVersion": 3 }
```

---

### ğŸ¨ è·å–/ä¿å­˜ç”¨æˆ·å¸ƒå±€ï¼ˆä»…ä¸¤çº§ï¼šç³»ç»Ÿé»˜è®¤/ç”¨æˆ·ï¼‰
- GET: `/api/layout?scope=effective|user|default`
- POST: `/api/layout?scope=user|default`
```json
// POST Body ç¤ºä¾‹
{
  "layout": {
    "email": { "x": 0, "y": 0, "w": 6, "h": 1 },
    "rds": { "x": 0, "y": 1, "w": 12, "h": 2 }
  }
}
```

---

### âš™ï¸ æ ‡ç­¾ç”Ÿæˆå¸ƒå±€
- URL: `POST /api/layout/{customerId}/generate`
- Header: `Authorization: Bearer {token}`
- Body:
```json
{
  "tags": ["è”ç³»"],
  "mode": "flow",
  "save": true,
  "scope": "user"
}
```
- Response:
```json
{
  "mode": "flow",
  "items": {
    "email": { "order": 0, "w": 6 }
  }
}
```

---

### ğŸ›ï¸ ç”¨æˆ·åå¥½è®¾ç½®
- URL: `GET /api/user/preferences`
- Header: `Authorization: Bearer {token}`
- Response:
```json
{ "theme": "light", "language": "ja", "udfColor": "#1890ff" }
```

- URL: `PUT /api/user/preferences`
- Body:
```json
{ "theme": "dark", "language": "zh", "udfColor": "#ff5722" }
```
- Response:
```json
{ "success": true, "message": "åå¥½å·²ä¿å­˜" }
```

---

### ğŸŒ è·å–å¤šè¯­è¨€èµ„æº
- URL: `GET /api/i18n/{lang}`
- Response:
```json
{
  "LBL_CUSTOMER": "Customer",
  "BTN_SAVE": "ä¿å­˜",
  "LBL_EMAIL": "é‚®ç®±"
}
```

---

å¦‚æœä½ è¿˜éœ€è¦å­—æ®µæ–°å¢ã€å­—æ®µæ ‡ç­¾è®¾ç½®ã€æƒé™åˆ†é…ã€RDPç”Ÿæˆç­‰æ›´å®Œæ•´æ¥å£ï¼Œæˆ‘å¯ä»¥ç»§ç»­è¡¥å……ã€‚
