# TC-DATA-001 动态实体数据 CRUD

| 项目 | 内容 |
|------|------|
| **用例编号** | TC-DATA-001 |
| **用例名称** | 动态实体数据 CRUD |
| **所属领域** | 动态数据管理 |
| **测试类型** | 功能测试 |
| **优先级** | P0 - 关键路径 |
| **版本** | 1.0 |

---

## 1. 测试场景描述

### 1.1 业务背景
已发布的动态实体可以进行数据的增删改查操作，这是系统的核心业务功能。

### 1.2 涉及页面
- `/dynamic-entity/{FullTypeName}` - 动态实体数据页面
- `/{EntityType}/{Id}` - 单条记录页面（PageLoader）

---

## 2. 前置条件

| 条件编号 | 条件描述 |
|----------|----------|
| PRE-001 | 已发布 `TestProduct` 实体（TC-ENT-003） |
| PRE-002 | 已配置表单模板（TC-FORM-003）（可选） |

---

## 3. 测试数据

```json
{
  "createData": {
    "ProductName": "测试产品A",
    "Price": 99.99,
    "Category": "electronics",
    "Description": "这是一个测试产品"
  },
  "updateData": {
    "ProductName": "测试产品A（已更新）",
    "Price": 129.99
  }
}
```

---

## 4. 测试步骤

### 场景 A: 查看数据列表

| 步骤 | 操作描述 | 预期结果 | 截图 |
|------|----------|----------|------|
| A1 | 导航到 `TestProduct` 实体数据页面 | 显示数据列表（可能为空） | ✓ |
| A2 | 确认列表显示配置的字段列 | 表格列与实体字段对应 | - |

### 场景 B: 创建新记录

| 步骤 | 操作描述 | 预期结果 | 截图 |
|------|----------|----------|------|
| B1 | 点击"新建"按钮 | 显示数据录入表单 | ✓ |
| B2 | 填写产品名称 `测试产品A` | 输入成功 | - |
| B3 | 填写价格 `99.99` | 输入成功 | - |
| B4 | 选择分类 | 选择成功 | - |
| B5 | 填写描述 | 输入成功 | - |
| B6 | 点击保存 | 显示保存成功消息 | ✓ |
| B7 | 确认新记录出现在列表 | 数据行可见 | ✓ |

### 场景 C: 查看记录详情

| 步骤 | 操作描述 | 预期结果 | 截图 |
|------|----------|----------|------|
| C1 | 点击列表中某条记录 | 进入详情页面或弹出窗口 | ✓ |
| C2 | 确认显示所有字段值 | 数据正确展示 | - |

### 场景 D: 编辑记录

| 步骤 | 操作描述 | 预期结果 | 截图 |
|------|----------|----------|------|
| D1 | 点击编辑按钮 | 进入编辑模式 | - |
| D2 | 修改产品名称为 `测试产品A（已更新）` | 输入成功 | - |
| D3 | 修改价格为 `129.99` | 输入成功 | - |
| D4 | 保存修改 | 显示保存成功 | ✓ |
| D5 | 确认列表中数据已更新 | 新值显示正确 | ✓ |

### 场景 E: 删除记录

| 步骤 | 操作描述 | 预期结果 | 截图 |
|------|----------|----------|------|
| E1 | 点击删除按钮 | 显示确认对话框 | - |
| E2 | 确认删除 | 显示删除成功消息 | ✓ |
| E3 | 确认记录从列表中消失 | 列表更新 | ✓ |

### 场景 F: 数据验证

| 步骤 | 操作描述 | 预期结果 | 截图 |
|------|----------|----------|------|
| F1 | 尝试提交空的必填字段 | 显示验证错误 | ✓ |
| F2 | 在价格字段输入非法值 | 显示格式错误 | ✓ |

### 场景 G: 列表筛选和排序

| 步骤 | 操作描述 | 预期结果 | 截图 |
|------|----------|----------|------|
| G1 | 使用搜索/筛选功能 | 列表正确过滤 | ✓ |
| G2 | 点击列头排序 | 数据按列排序 | - |

### 场景 H: 分页（如有大量数据）

| 步骤 | 操作描述 | 预期结果 | 截图 |
|------|----------|----------|------|
| H1 | 创建足够多的记录触发分页 | 分页控件出现 | - |
| H2 | 点击下一页 | 显示下一页数据 | ✓ |

---

## 5. 预期结果汇总

| 结果编号 | 场景 | 预期结果 |
|----------|------|----------|
| EXP-001 | 查看列表 | 正确显示数据列表 |
| EXP-002 | 创建记录 | 数据保存成功 |
| EXP-003 | 查看详情 | 正确展示所有字段 |
| EXP-004 | 编辑记录 | 数据更新成功 |
| EXP-005 | 删除记录 | 数据删除成功 |
| EXP-006 | 数据验证 | 验证规则正确执行 |
| EXP-007 | 筛选排序 | 功能正常工作 |
| EXP-008 | 分页 | 分页正确显示 |

---

## 6. 后置条件

| 条件编号 | 条件描述 |
|----------|----------|
| POST-001 | 清理测试数据 |

---

## 7. AI 自动化测试注释

```yaml
test_type: e2e
requires_auth: admin
depends_on: TC-ENT-003
crud_operations: [create, read, update, delete]

cleanup:
  strategy: database
  priority: high  # 此测试创建大量数据，必须清理
  steps:
    # 删除所有测试产品数据
    - sql: DELETE FROM test_products WHERE ProductName LIKE '测试产品%'
      description: 删除测试创建的产品记录
    # 如果测试失败可能残留部分数据，使用更广泛的清理
    - sql: DELETE FROM test_products WHERE Id > 0 AND CreatedAt > datetime('now', '-1 hour')
      description: 删除1小时内创建的所有记录
  on_error: ignore  # 表可能不存在
  
cleanup_order: both  # 测试前后都清理，确保干净状态

verify_cleanup:
  - sql: SELECT COUNT(*) FROM test_products WHERE ProductName LIKE '测试产品%'
    expected: 0
```
