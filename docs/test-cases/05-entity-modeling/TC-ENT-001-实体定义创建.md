# TC-ENT-001 实体定义创建

| 项目 | 内容 |
|------|------|
| **用例编号** | TC-ENT-001 |
| **用例名称** | 实体定义创建 |
| **所属领域** | 实体建模 |
| **测试类型** | 功能测试 |
| **优先级** | P0 - 关键路径 |
| **版本** | 1.0 |

---

## 1. 测试场景描述

### 1.1 业务背景
BobCRM 支持动态实体建模，管理员可以创建自定义业务实体（如客户、订单、产品等），定义其元数据和字段结构。

### 1.2 测试目的
验证实体定义的创建流程，包括基本信息配置。

### 1.3 涉及页面
- `/entity-definitions` - 实体定义列表
- `/entity-definitions/create` - 创建实体定义

---

## 2. 前置条件

| 条件编号 | 条件描述 |
|----------|----------|
| PRE-001 | 以管理员身份登录 |
| PRE-002 | 实体名 `TestProduct` 尚不存在 |

---

## 3. 测试数据

```json
{
  "entityDefinition": {
    "name": "TestProduct",
    "displayName": "测试产品",
    "namespace": "BobCrm.Dynamic",
    "tableName": "test_products",
    "description": "用于测试的产品实体"
  }
}
```

---

## 4. 测试步骤

### 场景 A: 查看实体定义列表

| 步骤 | 操作描述 | 预期结果 | 截图 |
|------|----------|----------|------|
| A1 | 导航到 `/entity-definitions` | 显示实体定义列表页面 | ✓ |
| A2 | 确认页面加载成功 | 显示已有实体列表或空状态 | - |

### 场景 B: 创建新实体定义

| 步骤 | 操作描述 | 预期结果 | 截图 |
|------|----------|----------|------|
| B1 | 点击"创建实体"按钮 | 跳转到创建页面 | ✓ |
| B2 | 输入实体名称 `TestProduct` | 输入成功 | - |
| B3 | 输入显示名称 `测试产品` | 输入成功 | - |
| B4 | 输入命名空间 `BobCrm.Dynamic` | 输入成功 | - |
| B5 | 输入表名 `test_products` | 输入成功 | - |
| B6 | 输入描述说明 | 输入成功 | - |
| B7 | 点击保存（或下一步） | 实体基本信息保存成功 | ✓ |

### 场景 C: 实体名称重复验证

| 步骤 | 操作描述 | 预期结果 | 截图 |
|------|----------|----------|------|
| C1 | 尝试创建同名实体 `TestProduct` | 显示名称已存在错误 | ✓ |

---

## 5. 预期结果汇总

| 结果编号 | 场景 | 预期结果 |
|----------|------|----------|
| EXP-001 | 查看列表 | 正确显示实体列表 |
| EXP-002 | 创建实体 | 实体定义创建成功 |
| EXP-003 | 名称重复 | 阻止创建，显示错误 |

---

## 6. AI 自动化测试注释

```yaml
test_type: e2e
requires_auth: admin
continues_to: TC-ENT-002

# 此测试是实体建模流程的起点，统一在 TC-ENT-003 清理
cleanup:
  strategy: deferred
  defer_to: TC-ENT-003
  reason: 实体定义将在后续测试中继续使用
  
# 如果需要单独运行此测试，使用以下清理
standalone_cleanup:
  steps:
    - sql: DELETE FROM EntityDefinitions WHERE Name = 'TestProduct'
  on_error: ignore
```
