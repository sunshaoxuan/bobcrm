# TC-AUTH-002 用户登录

| 项目 | 内容 |
|------|------|
| **用例编号** | TC-AUTH-002 |
| **用例名称** | 用户登录 |
| **所属领域** | 认证与授权 |
| **测试类型** | 功能测试 / 安全测试 |
| **优先级** | P0 - 关键路径 |
| **版本** | 1.0 |

---

## 1. 测试场景描述

### 1.1 业务背景
用户通过登录页面输入凭据进入系统。登录成功后获取访问令牌，可访问受保护的功能。

### 1.2 测试目的
验证用户登录功能的正确性，包括凭据验证、令牌存储、页面跳转等。

### 1.3 涉及页面
- `/login` - 登录页面
- `/` - 仪表盘/首页（登录成功后）

---

## 2. 前置条件

| 条件编号 | 条件描述 |
|----------|----------|
| PRE-001 | 系统已完成初始化（管理员账户存在） |
| PRE-002 | 已知有效凭据：`admin` / `Admin@12345` |
| PRE-003 | 浏览器 localStorage 已清空（未登录状态） |

---

## 3. 测试数据

### 3.1 有效凭据

```json
{
  "username": "admin",
  "password": "Admin@12345"
}
```

### 3.2 无效凭据

```json
{
  "wrongPassword": { "username": "admin", "password": "WrongPass123" },
  "nonexistentUser": { "username": "unknown_user", "password": "Admin@12345" },
  "emptyCredentials": { "username": "", "password": "" },
  "sqlInjection": { "username": "admin' OR '1'='1", "password": "test" }
}
```

---

## 4. 测试步骤

### 场景 A: 正常登录流程（Happy Path）

| 步骤 | 操作描述 | 预期结果 | 截图 |
|------|----------|----------|------|
| A1 | 访问 `http://localhost:3000/login` | 显示登录页面，包含用户名和密码输入框 | ✓ |
| A2 | 确认页面含登录表单和相关UI元素 | 显示登录按钮、可能有"忘记密码"链接 | - |
| A3 | 在用户名字段输入 `admin` | 输入框显示输入内容 | - |
| A4 | 在密码字段输入 `Admin@12345` | 密码以掩码形式显示 | - |
| A5 | 点击登录按钮 | 显示加载状态 | - |
| A6 | 等待登录完成 | 页面跳转到仪表盘 `/` | ✓ |
| A7 | 验证 localStorage 中存在 `accessToken` | Token 已保存 | - |
| A8 | 验证 localStorage 中存在 `user` 信息 | 用户信息已保存 | - |
| A9 | 确认仪表盘页面正确显示用户信息 | 显示欢迎信息或用户名 | ✓ |

### 场景 B: 错误密码登录

| 步骤 | 操作描述 | 预期结果 | 截图 |
|------|----------|----------|------|
| B1 | 访问登录页面 | 显示登录表单 | - |
| B2 | 输入用户名 `admin`，密码 `WrongPass123` | 字段填充完成 | - |
| B3 | 点击登录按钮 | 显示错误消息"用户名或密码错误" | ✓ |
| B4 | 确认页面保持在登录页 | URL 仍为 `/login` | - |

### 场景 C: 不存在的用户

| 步骤 | 操作描述 | 预期结果 | 截图 |
|------|----------|----------|------|
| C1 | 输入用户名 `unknown_user`，密码 `Admin@12345` | 字段填充完成 | - |
| C2 | 点击登录按钮 | 显示错误消息（不应暴露用户是否存在） | ✓ |

### 场景 D: 空凭据提交

| 步骤 | 操作描述 | 预期结果 | 截图 |
|------|----------|----------|------|
| D1 | 不输入任何内容，直接点击登录按钮 | 显示字段必填验证错误 | ✓ |

### 场景 E: 邮箱登录（如支持）

| 步骤 | 操作描述 | 预期结果 | 截图 |
|------|----------|----------|------|
| E1 | 使用 `admin@example.com` 作为用户名登录 | 登录成功（如支持邮箱登录） | - |

### 场景 F: 已登录用户访问登录页

| 步骤 | 操作描述 | 预期结果 | 截图 |
|------|----------|----------|------|
| F1 | 在已登录状态下访问 `/login` | 自动重定向到仪表盘 | ✓ |

---

## 5. 预期结果汇总

| 结果编号 | 场景 | 预期结果 |
|----------|------|----------|
| EXP-001 | 正常登录 | 成功登录，跳转到仪表盘，Token 已保存 |
| EXP-002 | 错误密码 | 显示错误提示，保持在登录页 |
| EXP-003 | 不存在用户 | 显示通用错误，不暴露用户存在性 |
| EXP-004 | 空凭据 | 显示必填验证错误 |
| EXP-005 | 已登录访问 | 重定向到仪表盘 |

---

## 6. 后置条件

| 条件编号 | 条件描述 |
|----------|----------|
| POST-001 | 清除 localStorage 以便下次测试 |
| POST-002 | 登录成功后可进行后续功能测试 |

---

## 7. AI 自动化测试注释

```yaml
test_type: e2e
browser: chromium
timeout: 30000
depends_on: TC-AUTH-001
storage_validation:
  - localStorage.accessToken: exists
  - localStorage.refreshToken: exists
  - localStorage.user: json_valid
```
