# BobCRM æµ‹è¯•æŒ‡å—

æœ¬æ–‡æ¡£æä¾›å®Œæ•´çš„æµ‹è¯•æŒ‡å—ï¼ŒåŒ…æ‹¬ç¯å¢ƒéªŒè¯ã€å•å…ƒæµ‹è¯•ã€é›†æˆæµ‹è¯•å’Œç«¯åˆ°ç«¯æµ‹è¯•ã€‚

---

## ğŸ“‹ ç›®å½•

1. [ç¯å¢ƒéªŒè¯](#ç¯å¢ƒéªŒè¯)
2. [è‡ªåŠ¨åŒ–æµ‹è¯•](#è‡ªåŠ¨åŒ–æµ‹è¯•)
3. [æ‰‹åŠ¨åŠŸèƒ½æµ‹è¯•](#æ‰‹åŠ¨åŠŸèƒ½æµ‹è¯•)
4. [æ€§èƒ½æµ‹è¯•](#æ€§èƒ½æµ‹è¯•)
5. [å¸¸è§é—®é¢˜æ’æŸ¥](#å¸¸è§é—®é¢˜æ’æŸ¥)

---

## ç¯å¢ƒéªŒè¯

### å¿«é€ŸéªŒè¯

```powershell
# è¿è¡Œç¯å¢ƒéªŒè¯è„šæœ¬
pwsh scripts/verify-setup.ps1
```

æ­¤è„šæœ¬ä¼šæ£€æŸ¥ï¼š
- âœ… .NET 8 SDK ç‰ˆæœ¬
- âœ… PowerShell 7+ ç‰ˆæœ¬
- âœ… Docker å®‰è£…çŠ¶æ€
- âœ… é¡¹ç›®æ–‡ä»¶å®Œæ•´æ€§
- âœ… PostgreSQL æ•°æ®åº“è¿æ¥
- âœ… ç«¯å£å ç”¨æƒ…å†µï¼ˆ3000, 5200ï¼‰
- âœ… é¡¹ç›®ç¼–è¯‘çŠ¶æ€
- âœ… é›†æˆæµ‹è¯•æ‰§è¡Œ

### æ‰‹åŠ¨éªŒè¯æ­¥éª¤

#### 1. éªŒè¯ .NET SDK

```bash
dotnet --version
# åº”æ˜¾ç¤º: 8.x.x æˆ–æ›´é«˜ç‰ˆæœ¬ï¼ˆ.NET 9 ä¹Ÿå¯ä»¥ï¼Œå‘åå…¼å®¹ï¼‰
```

#### 2. éªŒè¯æ•°æ®åº“

```bash
# å¯åŠ¨PostgreSQLå®¹å™¨
docker compose up -d

# æ£€æŸ¥å®¹å™¨çŠ¶æ€
docker ps | grep bobcrm-pg

# æµ‹è¯•æ•°æ®åº“è¿æ¥
docker exec bobcrm-pg pg_isready -U postgres
```

#### 3. éªŒè¯ç¼–è¯‘

```bash
dotnet build BobCrm.sln
# åº”æ˜¾ç¤º: Build succeeded
```

---

## è‡ªåŠ¨åŒ–æµ‹è¯•

### é›†æˆæµ‹è¯•

#### è¿è¡Œæ‰€æœ‰æµ‹è¯•

```bash
# ç¡®ä¿PostgreSQLå®¹å™¨è¿è¡Œ
docker compose up -d

# è¿è¡Œæµ‹è¯•
dotnet test

# CI é—¨ç¦å¯¹é½ï¼ˆå»ºè®®ï¼‰
pwsh scripts/check-warning-baseline.ps1
dotnet test -c Release

# è¿è¡Œæµ‹è¯•å¹¶ç”Ÿæˆè¦†ç›–ç‡æŠ¥å‘Š
dotnet test --collect:"XPlat Code Coverage"
```

#### æµ‹è¯•è¦†ç›–ç‡

å½“å‰æµ‹è¯•è¦†ç›–ç‡ï¼š**91.8%**

```bash
# ç”Ÿæˆè¦†ç›–ç‡æŠ¥å‘Š
dotnet test --collect:"XPlat Code Coverage"

# å®‰è£…æŠ¥å‘Šç”Ÿæˆå·¥å…·ï¼ˆé¦–æ¬¡ï¼‰
dotnet tool install --global dotnet-reportgenerator-globaltool

# ç”ŸæˆHTMLæŠ¥å‘Š
reportgenerator \
  -reports:"tests/BobCrm.Api.Tests/TestResults/*/coverage.cobertura.xml" \
  -targetdir:"coverage-report" \
  -reporttypes:"Html"

# æ‰“å¼€æŠ¥å‘Š
start coverage-report/index.html
```

### æµ‹è¯•åˆ†ç±»

#### 1. è®¤è¯æµ‹è¯• (AuthTests.cs)

```bash
dotnet test --filter "FullyQualifiedName~AuthTests"
```

æµ‹è¯•å†…å®¹ï¼š
- âœ… ç”¨æˆ·æ³¨å†Œ
- âœ… é‚®ä»¶æ¿€æ´»
- âœ… ç™»å½•/ç™»å‡º
- âœ… ä»¤ç‰Œåˆ·æ–°
- âœ… ä¼šè¯ç®¡ç†
- âœ… 401/403é”™è¯¯å¤„ç†

#### 2. å®¢æˆ·ç®¡ç†æµ‹è¯• (CustomerTests.cs)

```bash
dotnet test --filter "FullyQualifiedName~CustomerTests"
```

æµ‹è¯•å†…å®¹ï¼š
- âœ… å®¢æˆ·åˆ—è¡¨æŸ¥è¯¢
- âœ… å®¢æˆ·è¯¦æƒ…æŸ¥è¯¢
- âœ… å®¢æˆ·æ•°æ®æ›´æ–°
- âœ… å­—æ®µéªŒè¯ï¼ˆå¿…å¡«ã€æ­£åˆ™ã€æœªçŸ¥å­—æ®µï¼‰
- âœ… å¹¶å‘å†²çªæ£€æµ‹ï¼ˆ409ï¼‰
- âœ… ç‰ˆæœ¬æ§åˆ¶

#### 3. å­—æ®µå®šä¹‰æµ‹è¯• (FieldTests.cs)

```bash
dotnet test --filter "FullyQualifiedName~FieldTests"
```

æµ‹è¯•å†…å®¹ï¼š
- âœ… å­—æ®µå®šä¹‰æŸ¥è¯¢
- âœ… å­—æ®µæ ‡ç­¾èšåˆ
- âœ… å­—æ®µåŠ¨ä½œé…ç½®

#### 4. å­—æ®µåŠ¨ä½œæµ‹è¯• (FieldActionTests.cs)

```bash
dotnet test --filter "FullyQualifiedName~FieldActionTests"
```

æµ‹è¯•å†…å®¹ï¼š
- âœ… RDPæ–‡ä»¶ç”Ÿæˆä¸ä¸‹è½½
- âœ… æ–‡ä»¶è·¯å¾„éªŒè¯
- âœ… Mailtoé“¾æ¥ç”Ÿæˆ
- âœ… å­—æ®µåŠ¨ä½œé‰´æƒ

#### 5. å¸ƒå±€ç®¡ç†æµ‹è¯• (LayoutTests.cs)

```bash
dotnet test --filter "FullyQualifiedName~LayoutTests"
```

æµ‹è¯•å†…å®¹ï¼š
- âœ… ç”¨æˆ·å¸ƒå±€è¯»å–/ä¿å­˜/åˆ é™¤
- âœ… é»˜è®¤æ¨¡æ¿ç®¡ç†ï¼ˆç®¡ç†å‘˜ï¼‰
- âœ… å¸ƒå±€ä½œç”¨åŸŸï¼ˆeffective/user/defaultï¼‰
- âœ… æŒ‰æ ‡ç­¾ç”Ÿæˆå¸ƒå±€ï¼ˆflow/freeæ¨¡å¼ï¼‰

#### 6. å›½é™…åŒ–æµ‹è¯• (I18nTests.cs)

```bash
dotnet test --filter "FullyQualifiedName~I18nTests"
```

æµ‹è¯•å†…å®¹ï¼š
- âœ… å¤šè¯­è¨€èµ„æºæŸ¥è¯¢
- âœ… è¯­è¨€åˆ—è¡¨è·å–
- âœ… è¯­è¨€å›é€€æœºåˆ¶
- âœ… é”™è¯¯æ¶ˆæ¯æœ¬åœ°åŒ–

#### 7. ç®¡ç†åŠŸèƒ½æµ‹è¯• (AdminTests.cs)

```bash
dotnet test --filter "FullyQualifiedName~AdminTests"
```

æµ‹è¯•å†…å®¹ï¼š
- âœ… æ•°æ®åº“å¥åº·æ£€æŸ¥
- âœ… æ•°æ®åº“é‡å»ºï¼ˆä»…å¼€å‘ç¯å¢ƒï¼‰
- âœ… ç®¡ç†å‘˜æƒé™æ§åˆ¶

#### 8. åŠ¨æ€å®ä½“æµ‹è¯• (DynamicEntityEndpointsTests.cs)

```bash
dotnet test --filter "FullyQualifiedName~DynamicEntityEndpointsTests"
```

æµ‹è¯•å†…å®¹ï¼š
- âœ… æŸ¥è¯¢åˆ—è¡¨/æŒ‰ ID è·å–ï¼ˆå« `lang` ä¸ `includeMeta` è¡Œä¸ºï¼‰
- âœ… å…ƒæ•°æ®è¿”å›æ¨¡å¼ï¼ˆå•è¯­/å¤šè¯­ï¼‰

---

## æ‰‹åŠ¨åŠŸèƒ½æµ‹è¯•

### å‰ç½®å‡†å¤‡

1. å¯åŠ¨ç³»ç»Ÿï¼š
```powershell
pwsh scripts/dev.ps1 -Action start
```

2. è®¿é—®å‰ç«¯ï¼šhttp://localhost:3000

3. å‡†å¤‡æµ‹è¯•è´¦å·ï¼š
   - ç®¡ç†å‘˜ï¼š`admin` / `Admin@12345`
   - æ™®é€šç”¨æˆ·ï¼šéœ€æ³¨å†Œåˆ›å»º

### æµ‹è¯•ç”¨ä¾‹æ¸…å•

#### âœ… 1. ç”¨æˆ·è®¤è¯æµç¨‹

| æ­¥éª¤ | æ“ä½œ | é¢„æœŸç»“æœ |
|------|------|----------|
| 1.1 | è®¿é—® http://localhost:3000 | è‡ªåŠ¨è·³è½¬åˆ°ç™»å½•é¡µ |
| 1.2 | ä½¿ç”¨ admin/Admin@12345 ç™»å½• | ç™»å½•æˆåŠŸï¼Œè·³è½¬åˆ°å®¢æˆ·åˆ—è¡¨ |
| 1.3 | ç‚¹å‡»å³ä¸Šè§’ç”¨æˆ·èœå• â†’ ç™»å‡º | æˆåŠŸç™»å‡ºï¼Œè¿”å›ç™»å½•é¡µ |
| 1.4 | ç‚¹å‡»"æ³¨å†Œ" | æ˜¾ç¤ºæ³¨å†Œè¡¨å• |
| 1.5 | å¡«å†™æ³¨å†Œä¿¡æ¯å¹¶æäº¤ | æ˜¾ç¤º"è¯·æ£€æŸ¥é‚®ç®±æ¿€æ´»" |

#### âœ… 2. å®¢æˆ·åˆ—è¡¨åŠŸèƒ½

| æ­¥éª¤ | æ“ä½œ | é¢„æœŸç»“æœ |
|------|------|----------|
| 2.1 | ç™»å½•åæŸ¥çœ‹å®¢æˆ·åˆ—è¡¨ | æ˜¾ç¤ºC001å’ŒC002ä¸¤ä¸ªå®¢æˆ· |
| 2.2 | æœç´¢"C001" | åˆ—è¡¨åªæ˜¾ç¤ºC001 |
| 2.3 | æ¸…ç©ºæœç´¢ | æ¢å¤æ˜¾ç¤ºæ‰€æœ‰å®¢æˆ· |
| 2.4 | ç‚¹å‡»å®¢æˆ·è¡Œ | è·³è½¬åˆ°å®¢æˆ·è¯¦æƒ…é¡µ |

#### âœ… 3. å®¢æˆ·è¯¦æƒ…åŠŸèƒ½

| æ­¥éª¤ | æ“ä½œ | é¢„æœŸç»“æœ |
|------|------|----------|
| 3.1 | è®¿é—® /customer/1 | æ˜¾ç¤ºC001å®¢æˆ·è¯¦æƒ… |
| 3.2 | æŸ¥çœ‹åŠ¨æ€å­—æ®µï¼ˆé‚®ç®±ã€RDSç­‰ï¼‰ | æ­£ç¡®æ˜¾ç¤ºæ‰€æœ‰å­—æ®µåŠå…¶å€¼ |
| 3.3 | ç‚¹å‡»"ç¼–è¾‘" | åˆ‡æ¢åˆ°ç¼–è¾‘æ¨¡å¼ |
| 3.4 | ä¿®æ”¹é‚®ç®±å­—æ®µ | å¯ä»¥è¾“å…¥ |
| 3.5 | ç‚¹å‡»"ä¿å­˜" | ä¿å­˜æˆåŠŸï¼Œæ˜¾ç¤ºæ–°å€¼ |
| 3.6 | åˆ·æ–°é¡µé¢ | æ–°å€¼å·²æŒä¹…åŒ– |

#### âœ… 4. å­—æ®µåŠ¨ä½œåŠŸèƒ½

| æ­¥éª¤ | æ“ä½œ | é¢„æœŸç»“æœ |
|------|------|----------|
| 4.1 | åœ¨é‚®ç®±å­—æ®µæ—ç‚¹å‡»"å‘é‚®ä»¶"å›¾æ ‡ | æ‰“å¼€é‚®ä»¶å®¢æˆ·ç«¯ |
| 4.2 | åœ¨RDSå­—æ®µæ—ç‚¹å‡»"ä¸‹è½½RDP"æŒ‰é’® | ä¸‹è½½.rdpæ–‡ä»¶ |
| 4.3 | åŒå‡».rdpæ–‡ä»¶ | æ‰“å¼€è¿œç¨‹æ¡Œé¢è¿æ¥ |
| 4.4 | åœ¨é“¾æ¥å­—æ®µæ—ç‚¹å‡»"æ‰“å¼€"å›¾æ ‡ | åœ¨æ–°æ ‡ç­¾é¡µæ‰“å¼€URL |

#### âœ… 5. è¡¨å•è®¾è®¡å™¨åŠŸèƒ½

| æ­¥éª¤ | æ“ä½œ | é¢„æœŸç»“æœ |
|------|------|----------|
| 5.1 | è®¿é—® /designer | æ˜¾ç¤ºè¡¨å•è®¾è®¡å™¨ |
| 5.2 | ä»å·¥å…·ç®±æ‹–æ‹½Textboxåˆ°ç”»å¸ƒ | æ˜¾ç¤ºæ–°æ§ä»¶ |
| 5.3 | ç‚¹å‡»æ§ä»¶ | å³ä¾§æ˜¾ç¤ºå±æ€§é¢æ¿ |
| 5.4 | ä¿®æ”¹æ§ä»¶å®½åº¦/é«˜åº¦ | æ§ä»¶å°ºå¯¸å®æ—¶å˜åŒ– |
| 5.5 | æ‹–åŠ¨æ§ä»¶é è¿‘å…¶ä»–æ§ä»¶ | æ˜¾ç¤ºè“è‰²å¯¹é½çº¿ |
| 5.6 | ç‚¹å‡»"ä¿å­˜å¸ƒå±€" | ä¿å­˜æˆåŠŸæç¤º |

#### âœ… 6. å¤šè¯­è¨€åŠŸèƒ½

| æ­¥éª¤ | æ“ä½œ | é¢„æœŸç»“æœ |
|------|------|----------|
| 6.1 | ç‚¹å‡»å³ä¸Šè§’è¯­è¨€é€‰æ‹©å™¨ | æ˜¾ç¤ºï¼šæ—¥è¯­/ä¸­æ–‡/è‹±æ–‡ |
| 6.2 | åˆ‡æ¢åˆ°ä¸­æ–‡ | ç•Œé¢æ–‡å­—å˜ä¸ºä¸­æ–‡ |
| 6.3 | åˆ‡æ¢åˆ°æ—¥è¯­ | ç•Œé¢æ–‡å­—å˜ä¸ºæ—¥è¯­ |
| 6.4 | åˆ·æ–°é¡µé¢ | è¯­è¨€é€‰æ‹©ä¿æŒä¸å˜ |

#### âœ… 7. æƒé™æ§åˆ¶åŠŸèƒ½

| æ­¥éª¤ | æ“ä½œ | é¢„æœŸç»“æœ |
|------|------|----------|
| 7.1 | ä½¿ç”¨æ™®é€šç”¨æˆ·è®¿é—®å®¢æˆ·è¯¦æƒ… | å¯æŸ¥çœ‹ |
| 7.2 | ç‚¹å‡»"ç¼–è¾‘" | å¦‚æ— ç¼–è¾‘æƒé™ï¼ŒæŒ‰é’®ç¦ç”¨ |
| 7.3 | ä½¿ç”¨ç®¡ç†å‘˜è®¿é—® /designer | å¯è®¿é—® |
| 7.4 | ä½¿ç”¨æ™®é€šç”¨æˆ·è®¿é—® /designer | 403é”™è¯¯æˆ–è·³è½¬ |

---

## æ€§èƒ½æµ‹è¯•

### é¡µé¢åŠ è½½æ€§èƒ½

```powershell
# ä½¿ç”¨æµè§ˆå™¨å¼€å‘è€…å·¥å…·ï¼ˆF12ï¼‰
# Networkæ ‡ç­¾ â†’ åˆ·æ–°é¡µé¢
# æ£€æŸ¥ä»¥ä¸‹æŒ‡æ ‡ï¼š
```

**ç›®æ ‡æŒ‡æ ‡**ï¼š
- é¦–å±åŠ è½½æ—¶é—´ï¼š< 2ç§’
- APIå“åº”æ—¶é—´ï¼š< 500ms
- å®¢æˆ·åˆ—è¡¨æŸ¥è¯¢ï¼š< 200ms
- å®¢æˆ·è¯¦æƒ…æŸ¥è¯¢ï¼š< 300ms

### å‹åŠ›æµ‹è¯•

```bash
# ä½¿ç”¨ Apache Bench æµ‹è¯•APIæ€§èƒ½
ab -n 1000 -c 10 http://localhost:5200/api/customers
```

**ç›®æ ‡æŒ‡æ ‡**ï¼š
- å¹¶å‘10ç”¨æˆ·ï¼š> 100 req/sec
- é”™è¯¯ç‡ï¼š< 1%

---

## å¸¸è§é—®é¢˜æ’æŸ¥

### é—®é¢˜1ï¼šæµ‹è¯•å¤±è´¥ - æ•°æ®åº“è¿æ¥é”™è¯¯

**ç—‡çŠ¶**ï¼š
```
System.InvalidOperationException: Cannot connect to database
```

**è§£å†³æ–¹æ¡ˆ**ï¼š
```bash
# 1. æ£€æŸ¥PostgreSQLå®¹å™¨
docker ps | grep bobcrm-pg

# 2. å¦‚æœæœªè¿è¡Œï¼Œå¯åŠ¨å®¹å™¨
docker compose up -d

# 3. ç­‰å¾…å‡ ç§’åé‡è¯•
docker exec bobcrm-pg pg_isready -U postgres
```

### é—®é¢˜2ï¼šæµ‹è¯•å¤±è´¥ - ç«¯å£è¢«å ç”¨

**ç—‡çŠ¶**ï¼š
```
Unable to bind to http://localhost:5200
```

**è§£å†³æ–¹æ¡ˆ**ï¼š
```bash
# 1. åœæ­¢å¯èƒ½å ç”¨ç«¯å£çš„è¿›ç¨‹
pwsh scripts/dev.ps1 -Action stop

# 2. æ£€æŸ¥ç«¯å£å ç”¨
netstat -ano | findstr ":5200"

# 3. ç»ˆæ­¢å ç”¨è¿›ç¨‹ï¼ˆä½¿ç”¨PIDï¼‰
taskkill /PID <PID> /F
```

### é—®é¢˜3ï¼šå‰ç«¯æ— æ³•è®¿é—®API

**ç—‡çŠ¶**ï¼š
- å‰ç«¯æ˜¾ç¤º"è¿æ¥å¤±è´¥"
- æµè§ˆå™¨æ§åˆ¶å°æ˜¾ç¤º404æˆ–CORSé”™è¯¯

**è§£å†³æ–¹æ¡ˆ**ï¼š
```bash
# 1. ç¡®è®¤APIæ­£åœ¨è¿è¡Œ
curl http://localhost:5200/api/i18n/ja

# 2. æ£€æŸ¥å‰ç«¯APIé…ç½®
cat src/BobCrm.App/appsettings.json | grep BaseUrl

# 3. ç¡®è®¤ä¸¤è€…ç«¯å£ä¸€è‡´
```

### é—®é¢˜4ï¼šç™»å½•å¤±è´¥

**ç—‡çŠ¶**ï¼š
- è¾“å…¥admin/Admin@12345åæ˜¾ç¤º"ç”¨æˆ·åæˆ–å¯†ç é”™è¯¯"

**è§£å†³æ–¹æ¡ˆ**ï¼š
```bash
# 1. é‡å»ºæ•°æ®åº“ï¼ˆä¼šé‡ç½®ç®¡ç†å‘˜å¯†ç ï¼‰
curl -X POST http://localhost:5200/api/admin/db/recreate

# 2. æˆ–ä½¿ç”¨Setupé¡µé¢é‡æ–°é…ç½®ç®¡ç†å‘˜
# è®¿é—® http://localhost:3000/setup
```

### é—®é¢˜5ï¼šæµ‹è¯•è¦†ç›–ç‡æŠ¥å‘Šç”Ÿæˆå¤±è´¥

**ç—‡çŠ¶**ï¼š
```
reportgenerator: command not found
```

**è§£å†³æ–¹æ¡ˆ**ï¼š
```bash
# å®‰è£…å…¨å±€å·¥å…·
dotnet tool install --global dotnet-reportgenerator-globaltool

# æ·»åŠ åˆ°PATHï¼ˆå¦‚æœéœ€è¦ï¼‰
# Windows: %USERPROFILE%\.dotnet\tools
# Linux/Mac: ~/.dotnet/tools
```

---

## æµ‹è¯•æŠ¥å‘Šæ¨¡æ¿

### æµ‹è¯•æ‰§è¡ŒæŠ¥å‘Š

**æµ‹è¯•æ—¥æœŸ**ï¼š2025-11-05

**æµ‹è¯•ç¯å¢ƒ**ï¼š
- OS: Windows 11
- .NET: 8.0.10
- PostgreSQL: 16-alpine
- æµè§ˆå™¨: Chrome 119

**æµ‹è¯•ç»“æœ**ï¼š

| æµ‹è¯•ç±»åˆ« | æµ‹è¯•ç”¨ä¾‹æ•° | é€šè¿‡ | å¤±è´¥ | è·³è¿‡ | é€šè¿‡ç‡ |
|---------|----------|------|------|------|--------|
| è®¤è¯æµ‹è¯• | 12 | 12 | 0 | 0 | 100% |
| å®¢æˆ·ç®¡ç† | 18 | 18 | 0 | 0 | 100% |
| å­—æ®µå®šä¹‰ | 8 | 8 | 0 | 0 | 100% |
| å­—æ®µåŠ¨ä½œ | 12 | 12 | 0 | 0 | 100% |
| å¸ƒå±€ç®¡ç† | 10 | 10 | 0 | 0 | 100% |
| å›½é™…åŒ– | 6 | 6 | 0 | 0 | 100% |
| ç®¡ç†åŠŸèƒ½ | 4 | 4 | 0 | 0 | 100% |
| **æ€»è®¡** | **70** | **70** | **0** | **0** | **100%** |

**æ€§èƒ½æµ‹è¯•**ï¼š
- é¦–å±åŠ è½½ï¼š1.2s âœ…
- APIå¹³å‡å“åº”ï¼š145ms âœ…
- å¹¶å‘å¤„ç†ï¼š150 req/sec âœ…

**ç¼ºé™·æŠ¥å‘Š**ï¼š
- æ— 

**ç»“è®º**ï¼š
âœ… æ‰€æœ‰æµ‹è¯•é€šè¿‡ï¼Œç³»ç»ŸåŠŸèƒ½æ­£å¸¸ï¼Œæ€§èƒ½ç¬¦åˆé¢„æœŸã€‚

---

## æŒç»­é›†æˆï¼ˆCIï¼‰é…ç½®

### GitHub Actions ç¤ºä¾‹

åˆ›å»º `.github/workflows/test.yml`ï¼š

```yaml
name: Test

on:
  push:
    branches: [ main, develop ]
  pull_request:
    branches: [ main ]

jobs:
  test:
    runs-on: ubuntu-latest
    
    services:
      postgres:
        image: postgres:16-alpine
        env:
          POSTGRES_USER: postgres
          POSTGRES_PASSWORD: postgres
          POSTGRES_DB: bobcrm
        ports:
          - 5432:5432
        options: >-
          --health-cmd pg_isready
          --health-interval 10s
          --health-timeout 5s
          --health-retries 5
    
    steps:
    - uses: actions/checkout@v3
    
    - name: Setup .NET
      uses: actions/setup-dotnet@v3
      with:
        dotnet-version: '8.0.x'
    
    - name: Restore dependencies
      run: dotnet restore
    
    - name: Build
      run: dotnet build --no-restore
    
    - name: Test
      run: dotnet test --no-build --verbosity normal --collect:"XPlat Code Coverage"
    
    - name: Upload coverage
      uses: codecov/codecov-action@v3
      with:
        files: ./tests/BobCrm.Api.Tests/TestResults/*/coverage.cobertura.xml
```

---

## é™„å½•

### æµ‹è¯•æ•°æ®åº“åˆå§‹åŒ–

ç³»ç»Ÿå¯åŠ¨æ—¶ä¼šè‡ªåŠ¨åˆå§‹åŒ–ä»¥ä¸‹æµ‹è¯•æ•°æ®ï¼š

**ç”¨æˆ·**ï¼š
- admin (ç®¡ç†å‘˜)

**å®¢æˆ·**ï¼š
- C001 - æµ‹è¯•å®¢æˆ·1
- C002 - æµ‹è¯•å®¢æˆ·2

**å­—æ®µå®šä¹‰**ï¼š
- email - é‚®ç®±å­—æ®µï¼ˆå¸¦mailtoåŠ¨ä½œï¼‰
- rds - RDSå­—æ®µï¼ˆå¸¦RDPä¸‹è½½åŠ¨ä½œï¼‰
- website - ç½‘ç«™å­—æ®µï¼ˆå¸¦æ‰“å¼€é“¾æ¥åŠ¨ä½œï¼‰

**è¯­è¨€èµ„æº**ï¼š
- æ—¥è¯­ï¼ˆjaï¼‰
- ä¸­æ–‡ï¼ˆzhï¼‰
- è‹±æ–‡ï¼ˆenï¼‰

### ç›¸å…³æ–‡æ¡£

- [è®¾è®¡æ–‡æ¡£](./å®¢æˆ·ä¿¡æ¯ç®¡ç†ç³»ç»Ÿè®¾è®¡æ–‡æ¡£.md)
- [æ¥å£æ–‡æ¡£](./æ¥å£æ–‡æ¡£.md)
- [æ¶æ„é‡æ„æ€»ç»“](./æ¶æ„é‡æ„æ€»ç»“-v0.5.md)
- [README](../README.md)

