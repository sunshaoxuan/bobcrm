# 动态枚举系统使用指南

## 目标
帮助管理员在 **BobCRM** 中通过 UI 创建、编辑、删除枚举，并将其绑定到实体字段。

## 入口
- 侧边栏 **系统管理 → 枚举管理**（仅管理员可见）
- 路由: `/system/enums`

## 功能概览
| 操作 | 描述 | 权限码 |
|------|------|--------|
| **创建枚举** | 填写名称、键值对、是否启用，保存后自动生成 `EnumDefinitionDto`。 | `EnumCreate` |
| **编辑枚举** | 修改名称、选项、启用状态。保存后系统自动刷新关联字段的下拉列表。 | `EnumUpdate` |
| **删除枚举** | 只能删除未被任何实体字段引用的枚举。删除前会弹出确认。 | `EnumDelete` |
| **启用/禁用** | 通过开关快速切换枚举的可用状态，已禁用的枚举在表单中不再出现。 | `EnumToggle` |

## 使用步骤
1. **打开枚举管理页面**
   - 在侧边栏点击 **枚举管理**，页面位于 `/system/enums`。
2. **创建新枚举**
   - 点击右上角 **新建** 按钮，弹出表单。
   - 填写 **编码**（Code，唯一标识）、**名称**（支持多语言）、**选项列表**（Value → DisplayName），勾选 **启用**。
   - 保存后系统会自动为该枚举生成对应的 **字段选项**，在实体字段编辑器中即可选择。
3. **编辑已有枚举**
   - 在列表中点击对应行的 **编辑** 按钮。
   - 修改后保存，所有使用该枚举的字段会实时更新。
4. **删除枚举**
   - 仅当枚举未被任何字段引用时，删除按钮才会激活。
   - 删除后系统会清理关联的 `EnumOption` 数据。
5. **权限管理**
   - 枚举管理页面的按钮会根据当前用户的 **功能码** 自动隐藏/显示。
   - 在 **权限管理** 中为角色分配 `EnumCreate/EnumUpdate/EnumDelete` 等功能码即可控制访问。

## 常见问题
- **枚举被引用后无法删除**：先在实体字段编辑器中将使用该枚举的字段改为其他枚举或普通文本后再删除。
- **新增枚举后页面未刷新**：确保 `EnumDefinitionService` 已注入并在 `DefaultTemplateGenerator` 中启用了枚举字段的渲染。
- **权限不足**：联系管理员为对应角色分配 `Enum*` 功能码。

## 参考文档
- [ARCH-26-动态枚举系统设计](../design/ARCH-26-动态枚举系统设计.md)
- [GUIDE-11-实体定义与动态实体操作指南](GUIDE-11-实体定义与动态实体操作指南.md)
