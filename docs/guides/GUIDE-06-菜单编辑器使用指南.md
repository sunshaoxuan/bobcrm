# 菜单编辑器使用指南

## 目标
为管理员提供 **可视化菜单编辑器**，支持拖拽式层级配置、菜单链接到实体或自定义页面、以及权限码自动关联。

## 当前状态
**计划中** - 菜单编辑器功能尚未实现，本文档描述未来的设计目标。

## 规划入口
- 侧边栏 **系统管理 → 菜单编辑器**（仅管理员可见）
- 路由: `/system/menu-editor`

## 功能概览
| 功能 | 描述 | 关键组件 |
|------|------|----------|
| **层级拖拽** | 使用 Ant Design `Tree` + `Draggable`，支持任意层级的菜单节点拖拽排序。 | `MenuEditor.razor`、`AntDesign.Tree` |
| **链接配置** | 为每个节点配置 **链接类型**（实体路由、外部 URL、或自定义页面），并自动生成对应的 **功能码**（如 `Menu_Customers`）。 | `MenuLinkEditor` 组件 |
| **权限码自动关联** | 保存菜单时自动在 `Permission` 表中创建/更新对应的 **功能码**，确保后端权限校验同步。 | `MenuEditorService.SaveMenuTree` → `PermissionService.EnsureFunctionCode` |
| **实时预览** | 侧边栏实时刷新，展示编辑后菜单的实际效果。 | `Sidebar` 组件订阅 `MenuChanged` 事件 |
| **导入/导出** | 支持 JSON 导入/导出，便于在不同环境之间迁移菜单配置。 | `MenuEditorService.Export/Import` |

## 规划使用步骤
1. **打开编辑器**
   - 在侧边栏点击 **菜单编辑器**，进入 `MenuEditor.razor` 页面。
2. **新增节点**
   - 点击 **+** 按钮，新建根节点或子节点，填写 **名称**、**图标**（可选）以及 **链接**。
3. **拖拽排序**
   - 拖动节点到目标位置，系统会自动更新 `Order` 字段。
4. **配置权限码**
   - 为每个菜单项选择 **关联功能码**（系统会默认生成 `Menu_{Entity}`），如需自定义可手动编辑。
5. **保存**
   - 点击 **保存**，后端会持久化菜单结构并同步权限码。
6. **预览**
   - 保存后侧边栏立即刷新，验证菜单显示与权限控制是否符合预期。

## 设计考量
- **权限集成**：自动生成或关联功能权限码（Function Codes），确保菜单可见性与用户权限严格同步。
- **动态路由映射**：支持将菜单链接到动态实体（如 `/customer`）或自定义页面。
- **多级层次结构**：支持无限层级的菜单嵌套。

## 实施计划
详见 [PROC-06-v0.6.0-开发计划](../history/PROC-06-v0.6.0-开发计划.md) (已完成) 中的 1.2 节。

## 参考文档
- [ARCH-24-紧凑型顶部菜单导航设计](../design/ARCH-24-紧凑型顶部菜单导航设计.md)
- [ARCH-24-紧凑型顶部菜单导航-实施计划](../process/ARCH-24-紧凑型顶部菜单导航-实施计划.md)
