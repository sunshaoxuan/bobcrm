============================= test session starts =============================
platform win32 -- Python 3.12.10, pytest-9.0.2, pluggy-1.6.0 -- C:\Users\sunsx\AppData\Local\Programs\Python\Python312\python.exe
cachedir: .pytest_cache
rootdir: C:\workspace\bobcrm
plugins: base-url-2.1.0, playwright-0.7.2
collecting ... collected 1 item

tests/e2e/cases/06_form_design/test_batch2_runtime.py::test_batch2_003_runtime_renders_tabbox_and_number_input[chromium] FAILED [100%]

================================== FAILURES ===================================
______ test_batch2_003_runtime_renders_tabbox_and_number_input[chromium] ______

auth_admin = <Page url='http://localhost:3000/product/7'>
page = <Page url='http://localhost:3000/product/7'>
standard_product = {'entity_id': 'c0279b13-a56c-451a-8bd4-934dd2040c10', 'entity_route': 'product', 'full_type_name': 'BobCrm.Base.Custom.Product'}

    def test_batch2_003_runtime_renders_tabbox_and_number_input(auth_admin, page: Page, standard_product):
        page = auth_admin
        entity_type = standard_product["entity_route"]
        full_type = standard_product["full_type_name"]
    
        _ensure_template_has_tabbox(entity_type)
        entity_id = _ensure_product_instance(full_type)
    
        # Verify API route used by PageLoader exists before UI (reduce flaky UI failures)
        assert api_helper.login_as_admin()
        check = requests.get(
            f"{API_BASE}/api/{entity_type}s/{entity_id}",
            headers=api_helper.get_headers(),
            timeout=30,
        )
        assert check.status_code == 200, check.text
    
        page.goto(f"{BASE_URL}/{entity_type}/{entity_id}")
>       _wait_for_runtime_loaded(page)

tests\e2e\cases\06_form_design\test_batch2_runtime.py:251: 
_ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _

page = <Page url='http://localhost:3000/product/7'>

    def _wait_for_runtime_loaded(page: Page) -> None:
        # PageLoader is interactive server; wait for LoadDataAsync completion (loading -> runtime-shell).
>       expect(page.locator(".runtime-shell")).to_be_visible(timeout=30000)
E       AssertionError: Locator expected to be visible
E       Actual value: None
E       Error: element(s) not found 
E       Call log:
E         - Expect "to_be_visible" with timeout 30000ms
E         - waiting for locator(".runtime-shell")

tests\e2e\cases\06_form_design\test_batch2_runtime.py:229: AssertionError
=========================== short test summary info ===========================
FAILED tests/e2e/cases/06_form_design/test_batch2_runtime.py::test_batch2_003_runtime_renders_tabbox_and_number_input[chromium]
======================== 1 failed in 73.87s (0:01:13) =========================
